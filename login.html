<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивті Математика Курсы</title>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script>
        // Paste your Firebase config object here AGAIN
        const firebaseConfig = {
            apiKey: "СІЗДІҢ_API_KEY",
            authDomain: "СІЗДІҢ_PROJECT_ID.firebaseapp.com",
            projectId: "СІЗДІҢ_PROJECT_ID",
            storageBucket: "СІЗДІҢ_PROJECT_ID.appspot.com",
            messagingSenderId: "СІЗДІҢ_SENDER_ID",
            appId: "СІЗДІҢ_APP_ID"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Check user's login state
        auth.onAuthStateChanged((user) => {
            if (!user) {
                // If user is not logged in, redirect to login page
                window.location.href = 'login.html';
            }
        });

        function logout() {
            auth.signOut().then(() => {
                // Sign-out successful, redirect to login page
                window.location.href = 'login.html';
            });
        }
    </script>
    <style>
        /* Сіздің алдыңғы CSS стильдеріңіз осында қалады... */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');
        :root {
            --bg-color: #1a1a2e;
            --card-bg-color: #16213e;
            --text-color: #e0e0e0;
            --primary-color: #0f3460;
            --accent-color-1: #e94560;
            --gradient-start: #8e44ad;
            --gradient-end: #3498db;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Cg fill='%2316213e' fill-opacity='0.4'%3E%3Cpath fill-rule='evenodd' d='M11 0l5 20H6l5-20zm42 31h20l-5 20h-20l5-20zm-22 25h20l-5 20h-20l5-20z M0 5l20-5 -5 20-20 5zm80 0l-20-5 5 20 20 5zM21 80l20-5-5-20-20 5zm40 0l20-5-5-20-20 5z'/%3E%3C/g%3E%3C/svg%3E");
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1200px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative; /* Added for logout button positioning */
        }
        header h1 {
            font-size: 2.5em;
            font-weight: 700;
            color: white;
            text-shadow: 0 0 10px var(--accent-color-1);
        }
        #logoutButton {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--accent-color-1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        #logoutButton:hover {
            opacity: 0.9;
        }
        /* ... қалған барлық стильдер өзгеріссіз қалады ... */
        .progress-section { background-color: var(--card-bg-color); border-radius: 12px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        .progress-section h2 { margin-top: 0; font-size: 1.2em; text-align: center; }
        .progress-bar-container { width: 100%; background-color: #2c3e50; border-radius: 25px; overflow: hidden; height: 25px; }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end)); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.9em; color: white; transition: width 0.5s ease-in-out; }
        .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .lesson-card { background-color: var(--card-bg-color); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); border-left: 5px solid transparent; transition: all 0.3s ease; display: flex; flex-direction: column; }
        .lesson-card.completed { border-left: 5px solid var(--gradient-end); }
        .lesson-card h3 { margin-top: 0; font-size: 1.3em; color: white; }
        .lesson-actions { margin-top: auto; display: flex; flex-direction: column; gap: 15px; }
        .lesson-links { display: flex; justify-content: space-between; gap: 10px; }
        .lesson-links a { text-decoration: none; color: white; padding: 12px 15px; border-radius: 8px; text-align: center; font-weight: 600; transition: all 0.3s ease; flex-grow: 1; }
        .video-link { background-color: var(--primary-color); }
        .video-link:hover { background-color: #1a4a8a; }
        .homework-btn { background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end)); box-shadow: 0 4px 10px rgba(142, 68, 173, 0.4); }
        .homework-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(52, 152, 219, 0.5); }
        .progress-checkbox-container { display: flex; align-items: center; margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; background-color: rgba(255, 255, 255, 0.05); }
        .progress-checkbox-container input { margin-right: 12px; width: 18px; height: 18px; accent-color: var(--gradient-end); cursor: pointer; }
    </style>
</head>
<body>
    <div class="container" style="visibility: hidden;"> <header>
            <h1>Математика Курсы</h1>
            <button id="logoutButton" onclick="logout()">Шығу</button>
        </header>

        <section class="progress-section">
            <h2>Сіздің прогрессіңіз</h2>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </section>

        <main class="course-grid" id="courseGrid">
            </main>
    </div>

    <script>
        // Бұл скрипт тек авторизациядан өткеннен кейін ғана іске қосылады
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is logged in, show the content
                document.querySelector('.container').style.visibility = 'visible';
                
                // Сіздің алдыңғы JavaScript кодыңыз осында басталады
                const courseData = [
                    { lesson: 1, video: 'https://www.youtube.com/watch?v=L14Ef4XNUiE', homework: 'https://drive.google.com/file/d/12or8f_KloqF-ADdHHTfsHmqB0rZPjv0d/view?usp=sharing' },
                    // ... қалған сабақтар тізімі ...
                    { lesson: 16, video: 'https://youtu.be/eciVBVMv3Vo', homework: 'https://drive.google.com/file/d/13lg7xuyXqjUNBZzVFOQtVNbbXtAxEg7A/view?usp=sharing' },
                ];
                
                const courseGrid = document.getElementById('courseGrid');
                const progressBar = document.getElementById('progressBar');
                const totalLessons = courseData.length;
                let progressState = [];

                // Прогрессті сақтау кілтін оқушыға байланыстыру
                const progressStorageKey = `mathCourseProgress_${user.uid}`;

                function generateCourseCards() {
                    // ... generateCourseCards функциясының коды өзгеріссіз қалады ...
                     courseData.forEach((item, index) => {
                        const card = document.createElement('div');
                        card.className = 'lesson-card';
                        card.id = `lesson-card-${index}`;

                        let homeworkButton = '';
                        if (item.homework) {
                            homeworkButton = `<a href="${item.homework}" target="_blank" class="homework-btn">Үй тапсырмасы</a>`;
                        }

                        card.innerHTML = `
                            <h3>${item.lesson}-сабақ</h3>
                            <div class="lesson-actions">
                                <label class="progress-checkbox-container" for="lesson-${index}">
                                    <input type="checkbox" class="progress-checkbox" id="lesson-${index}" data-index="${index}">
                                    Орындалды
                                </label>
                                <div class="lesson-links">
                                    <a href="${item.video}" target="_blank" class="video-link">Видеоны көру</a>
                                    ${homeworkButton}
                                </div>
                            </div>
                        `;
                        courseGrid.appendChild(card);
                    });
                }
                
                function updateProgress() {
                    // ... updateProgress функциясының коды өзгеріссіз қалады ...
                    const checkedBoxes = document.querySelectorAll('.progress-checkbox:checked').length;
                    const percentage = totalLessons > 0 ? Math.round((checkedBoxes / totalLessons) * 100) : 0;
                    progressBar.style.width = percentage + '%';
                    progressBar.textContent = percentage + '%';
                    
                    document.querySelectorAll('.progress-checkbox').forEach((checkbox, index) => {
                        const card = document.getElementById(`lesson-card-${index}`);
                        if (checkbox.checked) {
                            card.classList.add('completed');
                        } else {
                            card.classList.remove('completed');
                        }
                    });

                    saveProgress();
                }

                function saveProgress() {
                    progressState = [];
                    document.querySelectorAll('.progress-checkbox').forEach(checkbox => {
                        progressState.push(checkbox.checked);
                    });
                    localStorage.setItem(progressStorageKey, JSON.stringify(progressState));
                }

                function loadProgress() {
                    const savedProgress = JSON.parse(localStorage.getItem(progressStorageKey));
                    if (savedProgress && savedProgress.length === totalLessons) {
                        progressState = savedProgress;
                        document.querySelectorAll('.progress-checkbox').forEach((checkbox, index) => {
                            checkbox.checked = progressState[index] || false;
                        });
                    }
                }

                // Бастапқы жүктеу
                generateCourseCards();
                loadProgress();
                updateProgress();

                courseGrid.addEventListener('change', (e) => {
                    if (e.target.classList.contains('progress-checkbox')) {
                        updateProgress();
                    }
                });
            }
        });
    </script>
</body>
</html>
